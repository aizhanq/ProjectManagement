<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Details</title>
</head>
<body>
    <h1>Детали проекта</h1>

    <!-- Здесь будут отображаться детали проекта -->
    <div id="projectDetails">
        <!-- Информация о проекте будет добавлена с помощью JavaScript -->
    </div>

    <h2>Сотрудники проекта</h2>

    <!-- Здесь будут отображаться сотрудники проекта -->
    <ul id="projectEmployees">
        <!-- Информация о сотрудниках будет добавлена с помощью JavaScript -->
    </ul>

    <!-- Поле с выпадающим списком всех сотрудников -->
    <label for="employeeDropdown">Добавить сотрудника:</label>
    <select id="employeeDropdown">
        <!-- Опции будут добавлены с помощью JavaScript -->
    </select>

    <!-- Кнопка "Добавить в проект" -->
    <button onclick="handleAddEmployee()">Добавить в проект</button>

    <script>
        // Ваши скрипты здесь

        // Получаем id проекта из URL
        const urlParams = new URLSearchParams(window.location.search);
        const projectId = urlParams.get('id');

        // Обработчик события для удаления сотрудника
        const handleDeleteEmployee = (employeeId) => {
            // Запрос на удаление сотрудника из проекта
            fetch(`/api/Project/${projectId}/employees/${employeeId}`, {
                method: 'DELETE'
            })
                .then(response => {
                    if (response.ok) {
                        // Обновляем список сотрудников после удаления
                        fetch(`/api/Project/${projectId}/employees`)
                            .then(response => response.json())
                            .then(employees => {
                                const projectEmployees = document.getElementById("projectEmployees");
                                // Очищаем текущий список
                                projectEmployees.innerHTML = "";
                                employees.forEach(employee => {
                                    const listItem = document.createElement("li");
                                    listItem.textContent = `${employee.firstName} ${employee.lastName}  `;

                                    // Добавляем кнопку "Удалить" с обработчиком события
                                    const deleteButton = document.createElement("button");
                                    deleteButton.textContent = "Удалить";
                                    deleteButton.addEventListener("click", () => handleDeleteEmployee(employee.employeeId));

                                    // Добавляем кнопку к списку сотрудников
                                    listItem.appendChild(deleteButton);
                                    projectEmployees.appendChild(listItem);
                                });
                            });
                    } else {
                        console.error('Failed to delete employee');
                    }
                })
                .catch(error => console.error('Error:', error));
        };

        // Запрашиваем информацию о проекте
        fetch(`/api/Project/${projectId}`)
            .then(response => response.json())
            .then(project => {
                const projectDetails = document.getElementById("projectDetails");
                projectDetails.innerHTML = `
                            <p><strong>Название проекта:</strong> ${project.projectName}</p>
                            <p><strong>Заказчик:</strong> ${project.customerCompany}</p>
                            <p><strong>Исполнитель:</strong> ${project.executorCompany}</p>
                            <p><strong>Дата начала:</strong> ${project.startDate}</p>
                            <p><strong>Дата окончания:</strong> ${project.endDate}</p>
                            <p><strong>Приоритет:</strong> ${project.priority}</p>
                        `;
            });

        // Запрашиваем информацию о сотрудниках проекта
        fetch(`/api/Project/${projectId}/employees`)
            .then(response => response.json())
            .then(employees => {
                const projectEmployees = document.getElementById("projectEmployees");
                employees.forEach(employee => {
                    const listItem = document.createElement("li");
                    listItem.textContent = `${employee.firstName} ${employee.lastName}  `;

                    // Добавляем кнопку "Удалить" с обработчиком события
                    const deleteButton = document.createElement("button");
                    deleteButton.textContent = "Удалить";
                    deleteButton.addEventListener("click", () => handleDeleteEmployee(employee.employeeId));

                    // Добавляем кнопку к списку сотрудников
                    listItem.appendChild(deleteButton);
                    projectEmployees.appendChild(listItem);
                });
            });

        // Запрашиваем информацию обо всех сотрудниках для выпадающего списка
        fetch(`/api/Employee`)
            .then(response => response.json())
            .then(employees => {
                const employeeDropdown = document.getElementById("employeeDropdown");

                // Добавляем опции для каждого сотрудника
                employees.forEach(employee => {
                    const option = document.createElement("option");
                    option.value = employee.employeeId;
                    option.textContent = `${employee.firstName} ${employee.lastName}`;
                    employeeDropdown.appendChild(option);
                });
            });

        // Обработчик события для добавления сотрудника в проект
        const handleAddEmployee = () => {
            const employeeId = document.getElementById("employeeDropdown").value;

            // Запрос на добавление сотрудника в проект
            fetch(`/api/Project/${projectId}/employees/${employeeId}`, {
                method: 'POST'
            })
                .then(response => {
                    if (response.ok) {
                        // Обновляем список сотрудников после добавления
                        fetch(`/api/Project/${projectId}/employees`)
                            .then(response => response.json())
                            .then(employees => {
                                const projectEmployees = document.getElementById("projectEmployees");
                                // Очищаем текущий список
                                projectEmployees.innerHTML = "";
                                employees.forEach(employee => {
                                    const listItem = document.createElement("li");
                                    listItem.textContent = `${employee.firstName} ${employee.lastName}  `;

                                    // Добавляем кнопку "Удалить" с обработчиком события
                                    const deleteButton = document.createElement("button");
                                    deleteButton.textContent = "Удалить";
                                    deleteButton.addEventListener("click", () => handleDeleteEmployee(employee.employeeId));

                                    // Добавляем кнопку к списку сотрудников
                                    listItem.appendChild(deleteButton);
                                    projectEmployees.appendChild(listItem);
                                });
                            });
                    } else {
                        console.error('Failed to add employee to project');
                    }
                })
                .catch(error => console.error('Error:', error));
        };
    </script>
</body>
</html>
